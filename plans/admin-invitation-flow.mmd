%% Admin Direct Invitation Flow
%% This diagram shows how admins can directly invite users without request

graph TD
    Start([Admin wants to invite user]) --> AdminDash[Admin Dashboard]
    AdminDash --> GenCodeBtn[Click Generate Access Code]

    GenCodeBtn --> RateLimit{Rate limit check<br/>50/day per admin}
    RateLimit -->|Exceeded| RateLimitError[Error: Daily limit reached]
    RateLimitError --> End1([Admin must wait])

    RateLimit -->|OK| GenCode[Generate unique 12-char code]
    GenCode --> SaveCode[Save to database<br/>- Code<br/>- Expires in 24hrs<br/>- Generated by admin ID<br/>- Type: admin_invite]
    SaveCode --> ShowModal[Show modal with:<br/>- Access code<br/>- Invitation URL<br/>- Copy button]

    ShowModal --> AdminChoice{Admin action}
    AdminChoice -->|Copy & share manually| ManualShare[Admin shares code<br/>via preferred method]
    AdminChoice -->|Use send invitation| SendEmailBtn[Click Send Invitation]

    SendEmailBtn --> EmailForm[Fill email form:<br/>- Recipient email<br/>- Recipient name<br/>- Optional message]
    EmailForm --> SendEmail[Send invitation email<br/>with access code]
    SendEmail --> EmailSent[Confirmation:<br/>Email sent successfully]

    ManualShare --> UserReceives[User receives code]
    EmailSent --> UserReceives

    UserReceives --> GoSignup[User visits signup page]
    GoSignup --> CodeParam{Code in URL?}
    CodeParam -->|Yes| AutoFill[Auto-fill code field]
    CodeParam -->|No| ManualEnter[User enters code manually]

    AutoFill --> Validate[Real-time validation]
    ManualEnter --> Validate

    Validate --> CheckCode{Code valid?}
    CheckCode -->|No - Invalid| ErrorInvalid[Error: Code not found]
    CheckCode -->|No - Expired| ErrorExpired[Error: Code expired 24hrs]
    CheckCode -->|No - Used| ErrorUsed[Error: Already used]

    ErrorInvalid --> End2([User must request new code])
    ErrorExpired --> End3([User must request new code])
    ErrorUsed --> End4([User must request new code])

    CheckCode -->|Yes| GreenCheck[Show green checkmark]
    GreenCheck --> FillForm[User fills signup form:<br/>- Name<br/>- Email<br/>- Password 8+ chars]
    FillForm --> Submit[Submit signup]

    Submit --> MarkUsed[Mark code as used<br/>- isUsed: true<br/>- usedByEmail<br/>- usedAt timestamp]
    MarkUsed --> CreateAccount[Create user account<br/>- Store code in user.accessCode]
    CreateAccount --> TrackLogin[Track login event]
    TrackLogin --> AutoSignIn[Auto sign in]
    AutoSignIn --> Dashboard([Redirect to Dashboard])

    style Start fill:#e1f5e1
    style Dashboard fill:#e1f5e1
    style End1 fill:#ffe1e1
    style End2 fill:#ffe1e1
    style End3 fill:#ffe1e1
    style End4 fill:#ffe1e1
    style RateLimitError fill:#ffcccc
    style ErrorInvalid fill:#ffcccc
    style ErrorExpired fill:#ffcccc
    style ErrorUsed fill:#ffcccc
    style GenCode fill:#fff4e1
    style SaveCode fill:#e1e8ff
    style SendEmail fill:#fff4e1
    style CreateAccount fill:#e1f5e1
